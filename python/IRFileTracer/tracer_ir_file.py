import matplotlib.pyplot as plt

from utils import load_ir_file

## trace_ir = [3435, 1604, 498, 408, 498, 407, 579, 1153, 499, 407, 579, 1153, 499, 407, 579, 327, 579, 327, 579, 1154, 578, 1155, 577, 328, 578, 327, 579, 327, 579, 1153, 579, 1154, 578, 327, 579, 327, 579, 327, 579, 327, 579, 327, 579, 328, 578, 328, 578, 327, 579, 327, 579, 327, 579, 328, 578, 327, 579, 327, 579, 1154, 578, 327, 579, 327, 579, 327, 579, 328, 578, 327, 579, 327, 579, 327, 579, 1183, 549, 327, 579, 328, 578, 327, 579, 327, 579, 1181, 551, 1155, 577, 1153, 580, 1155, 577, 1154, 579, 1155, 577, 1154, 578, 1154, 578, 327, 579, 328, 578, 1153, 580, 327, 579, 328, 578, 328, 578, 327, 579, 328, 578, 327, 579, 327, 579, 327, 579, 1155, 578, 1154, 578, 328, 578, 328, 578, 1155, 578, 327, 579, 328, 578, 327, 579, 328, 578, 328, 578, 1153, 579, 327, 579, 327, 579, 328, 578, 1154, 578, 328, 578, 328, 578, 328, 578, 328, 578, 328, 578, 1155, 578, 1155, 577, 328, 578, 328, 578, 327, 579, 327, 579, 328, 578, 327, 579, 327, 579, 327, 579, 327, 579, 328, 578, 328, 578, 328, 578, 327, 579, 327, 578, 327, 579, 327, 579, 328, 578, 328, 578, 327, 578, 328, 578, 327, 579, 327, 579, 328, 578, 328, 578, 327, 579, 327, 579, 327, 579, 328, 578, 327, 579, 328, 578, 327, 578, 328, 578, 328, 578, 328, 578, 328, 578, 1156, 576, 328, 578, 327, 579, 327, 579, 328, 578, 327, 578, 1154, 578, 327, 553]
# sequence_ref = [3317, 1577, 446, 369, 446, 369, 522, 1108, 447, 369, 521, 1111, 445, 370, 521, 293, 522, 294, 522, 1110, 521, 1110, 521, 294, 521, 294, 521, 293, 522, 1109, 522, 1109, 522, 294, 521, 294, 521, 293, 522, 294, 521, 293, 522, 293, 522, 294, 522, 294, 521, 294, 521, 294, 521, 294, 521, 293, 522, 293, 522, 1109, 522, 294, 521, 294, 521, 293, 522, 293, 522, 294, 521, 294, 521, 294, 521, 1138, 493, 294, 521, 294, 521, 294, 521, 294, 521, 1138, 493, 1110, 521, 1111, 520, 1110, 521, 1107, 524, 1108, 523, 1108, 523, 1110, 521, 294, 521, 294, 521, 1113, 518, 294, 521, 293, 522, 294, 521, 293, 522, 294, 521, 293, 522, 294, 521, 294, 521, 1112, 519, 1109, 522, 293, 522, 293, 522, 1109, 522, 294, 521, 294, 521, 294, 521, 294, 521, 293, 522, 1108, 523, 293, 522, 293, 522, 294, 521, 1111, 520, 294, 521, 294, 521, 294, 521, 294, 521, 294, 521, 1108, 523, 1110, 521, 294, 521, 294, 521, 295, 520, 294, 522, 294, 521, 294, 521, 294, 521, 294, 521, 295, 520, 294, 521, 294, 521, 295, 520, 294, 521, 295, 520, 294, 521, 294, 522, 294, 521, 295, 520, 295, 520, 295, 520, 295, 520, 295, 520, 295, 520, 295, 520, 294, 521, 295, 520, 295, 520, 295, 520, 295, 521, 295, 520, 295, 520, 296, 519, 295, 520, 295, 520, 295, 520, 1113, 518, 295, 520, 295, 520, 295, 520, 295, 520, 296, 519, 1111, 520, 295, 520, 1111, 520, 1110, 521, 295, 520]
## sequence_gen = [3435, 1604, 498, 408, 498, 407, 579, 1153, 499, 407, 579, 1153, 499, 407, 579, 327, 579, 327, 579, 1154, 578, 1155, 577, 328, 578, 327, 579, 327, 579, 1153, 579, 1154, 578, 327, 579, 327, 579, 327, 579, 327, 579, 327, 579, 328, 578, 328, 578, 327, 579, 327, 579, 327, 579, 328, 578, 327, 579, 327, 579, 1154, 578, 327, 579, 327, 579, 327, 579, 328, 578, 327, 579, 327, 579, 327, 579, 1183, 549, 327, 579, 328, 578, 327, 579, 327, 579, 1181, 551, 1155, 577, 1153, 580, 1155, 577, 1154, 579, 1155, 577, 1154, 578, 1154, 578, 327, 579, 328, 578, 1153, 580, 327, 579, 328, 578, 328, 578, 327, 579, 328, 578, 327, 579, 327, 579, 327, 579, 1155, 578, 1154, 578, 328, 578, 328, 578, 1155, 578, 327, 579, 328, 578, 327, 579, 328, 578, 328, 578, 1153, 579, 327, 579, 327, 579, 328, 578, 1154, 578, 328, 578, 328, 578, 328, 578, 328, 578, 328, 578, 1155, 578, 1155, 577, 328, 578, 328, 578, 327, 579, 327, 579, 328, 578, 327, 579, 327, 579, 327, 579, 327, 579, 328, 578, 328, 578, 328, 578, 327, 579, 327, 578, 327, 579, 327, 579, 328, 578, 328, 578, 327, 578, 328, 578, 327, 579, 327, 579, 328, 578, 328, 578, 327, 579, 327, 579, 327, 579, 328, 578, 327, 579, 328, 578, 327, 578, 328, 578, 328, 578, 328, 578, 328, 578, 1156, 576, 328, 578, 327, 579, 327, 579, 328, 578, 327, 578, 1154, 578, 327, 553]
# sequence_gen = [3376, 1652, 445, 459, 445, 460, 524, 1204, 445, 459, 525, 1205, 444, 458, 526, 378, 526, 378, 526, 1204, 525, 1204, 525, 378, 526, 379, 525, 377, 527, 1202, 527, 1203, 526, 380, 525, 378, 526, 380, 524, 378, 526, 379, 525, 378, 526, 379, 525, 378, 526, 379, 525, 379, 525, 379, 525, 379, 525, 379, 525, 1204, 525, 379, 525, 379, 525, 378, 526, 379, 525, 378, 526, 378, 526, 379, 525, 1231, 498, 379, 525, 379, 525, 379, 525, 378, 526, 1231, 498, 1205, 525, 1203, 526, 1203, 526, 1204, 525, 1205, 525, 1203, 526, 1204, 525, 378, 526, 379, 525, 1204, 525, 380, 524, 379, 525, 379, 525, 378, 526, 379, 525, 379, 525, 379, 525, 378, 526, 1203, 526, 1203, 526, 379, 525, 380, 524, 1205, 524, 379, 525, 379, 525, 378, 526, 378, 526, 379, 525, 1206, 523, 379, 525, 378, 526, 381, 523, 1204, 525, 378, 526, 378, 526, 378, 526, 379, 525, 378, 526, 1204, 525, 1203, 527, 379, 525, 379, 525, 378, 526, 379, 526, 379, 525, 380, 524, 380, 524, 379, 525, 380, 524, 377, 527, 379, 525, 379, 525, 379, 525, 379, 526, 379, 525, 378, 526, 379, 525, 379, 525, 378, 526, 379, 525, 379, 525, 379, 525, 379, 525, 378, 526, 378, 526, 378, 526, 379, 525, 379, 526, 379, 525, 379, 525, 379, 525, 378, 526, 379, 525, 379, 526, 378, 526, 1203, 526, 378, 526, 378, 526, 378, 526, 379, 525, 379, 525, 1205, 524, 379, 525, 1203, 526, 1204, 526, 378, 526]

ir_dict = load_ir_file('./assets/Clim_Avignon.ir')

cmd_ref = input('Commande de référence: ')
cmd_gen = input('Commande générée: ')

assert(cmd_ref in ir_dict.keys() and cmd_gen in ir_dict.keys())

sequence_ref = [int(k) for k in ir_dict[cmd_ref]['data'].split(' ')]
sequence_gen = [int(k) for k in ir_dict[cmd_gen]['data'].split(' ')]

ref_length = sum(sequence_ref)
gen_length = sum(sequence_gen)

max_length = max(ref_length, gen_length)
max_length += round(0.1 * max_length)

def trace_ir(ir_sequence):
    trace_ir_acum = [0]
    previous_value = 0
    for i in range(0, len(ir_sequence)):
        # Do it twice to get a square signal
        trace_ir_acum.append(ir_sequence[i] + previous_value)
        trace_ir_acum.append(ir_sequence[i] + previous_value)

        previous_value += ir_sequence[i]
    trace_ir_acum.append(ir_sequence[-1] + trace_ir_acum[-1])

    state_list = [1]
    for i in range(0, len(ir_sequence)):
        state_list += [1 if i % 2 == 0 else 0]
        state_list += [0 if i % 2 == 0 else 1]
    state_list += [1 if len(ir_sequence) % 2 == 0 else 0]

    return trace_ir_acum, state_list

x_ref, y_ref = trace_ir(sequence_ref)
x_gen, y_gen = trace_ir(sequence_gen)

print(x_ref)

plt1 = plt.subplot(2, 1, 1)
plt2 = plt.subplot(2, 1, 2)
plt1.plot(x_ref, y_ref, color='red', label='Reference')
plt1.set_title("Tracé de référence")

plt2.plot(x_gen, y_gen, color='blue', label='Généré')
plt2.set_title("Tracé généré")

plt1.set_xlim(0, max_length)
plt2.set_xlim(0, max_length)
plt.show()